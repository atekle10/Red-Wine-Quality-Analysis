---
title: "PSTAT-126 Project_WineQuality"
author: "Abel Tekle & Ethan Mayos"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
editor_options:
  markdown:
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, echo=FALSE}
# Load required packages
library(ggplot2)
library(reshape2)
library(dplyr)

```

```{r, echo=FALSE}
# Load the dataset
wine_data <- read.csv("winequality-red.csv", sep = ";")
```

The data set we chose to analyze is the Red Wine quality data set from the Wine quality data set.
It is from the UC Irvine Machine Learning repository.
It focuses on various characteristics of red wine, such as acidity levels, sugar content, and pH levels, along with a quality rating(from professional tasters).
Our aim is to understand the descriptive statistics of these variables and examine their interrelationships to gain preliminary insights into what constitutes a high rating.

### Variables Description:

-   **Fixed Acidity**: The amount of tartaric acid in wine, affecting the hardness and mouth feel.

    -   continuous RV, Quantitative

-   **Volatile Acidity**: The amount of acetic acid in wine, which at too high a level can lead to an unpleasant, vinegar-like taste.

    -   continuous RV , Quantitative

-   **Citric Acid**: Found in small quantities, it adds freshness and flavor to wines.

    -   continuous RV, Quantitative

-   **Residual Sugar**: The amount of sugar remaining after fermentation stops; it's rare to find wines with less than 1 gram/liter, and -wines with greater than 45 grams/liter are considered sweet.

    -   continuous RV, Quantitative

-   **Chlorides**: The amount of salt in the wine.

    -   continuous RV, Quantitative

-   **Free Sulfur Dioxide**: The free form of SO2 present in the wine; it prevents microbial growth and the oxidation of wine.

    -   continuous RV, Quantitative

-   **Total Sulfur Dioxide**: The amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable, while at higher concentrations, it has a burnt match smell.

    -   continuous RV, Quantitative

-   **Density**: The density of the wine, which can give an idea about the alcohol content and sweetness.

    -   continuous RV, Quantitative

-   **pH**: Describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4.

    -   continuous RV, Quantitative

-   **Sulphates**: A wine additive that contributes to SO2 levels and acts as an antimicrobial and antioxidant.

    -   continuous RV, Quantitative

-   **Alcohol**: The percentage of alcohol in the wine.

    -   continuous RV, Quantitative

-   **Quality**: The quality of the wine, judged by experts

    -   discrete RV, Quantitative

        **Observational Unit** : Each row in the data set represents a unique wine sample for which the above variables have been measured.
        The names of the wines have been excluded, observational units are numbered 1-1599
        


```{r, echo=FALSE}

# Randomly sample 500 observations from the dataset
wine_data_sampled <- sample_n(wine_data, 500)

```

**Since we are instructed to have at least 2 categorical variables we will need to convert two of these variables from quantitative to categorical. For this, we examined the data set and looked at the distributions and summary statistics to see which variables would be most suitable for these conversions. We will also randomly sample 500 observations from the data set for analysis**

<br><br>


```{r, echo=FALSE}
wine_data_sampled$categorical_pH <- cut(wine_data_sampled$pH, 
                                       breaks = c(-Inf, 3.21, 3.31, 3.41, Inf),
                                       labels = c('Very Low', 'Low', 'Medium', 'High'),
                                       include.lowest = TRUE)

wine_data_sampled$categorical_sulphates <- cut(wine_data_sampled$sulphates, 
                                              breaks = c(-Inf, 0.56, 0.62, 0.73, Inf),
                                              labels = c('Very Low', 'Low', 'Medium', 'High'),
                                              include.lowest = TRUE)
# Remove original 'pH' and 'sulphates' columns
wine_data_sampled <- wine_data_sampled %>% 
                     select(-pH, -sulphates)


#head(wine_data_sampled)

```


```{r, echo=FALSE}
#Display summary staistics of each variable 
skimr::skim(wine_data_sampled)
```

**The skim function used above helped to summarize the statistics of the data set in a table. The column n_missing displays the number of missing values of each variable in the data set, while complete_rate gives a percentage of how many values are present, rather than missing, for each variable. The sd column gives the standard deviation of each variable, while, p0, p25, p50, p75, and p100, represent the respective quartiles. Finally, the hist column displays a miniaturized histogram of each variable.**


<br><br>

```{r, echo=FALSE, warning=FALSE}
# Create histograms for each variable
# Get the names of numeric columns
features <- c("fixed.acidity","chlorides")
# Loop through each numeric feature to create a plot
for (feature in features) {
  print(
    ggplot(wine_data_sampled, aes_string(x = feature)) +
      geom_histogram(aes(y = after_stat(density)), binwidth = diff(range(wine_data_sampled[[feature]])) / 30) +
      geom_density(alpha = 0.1, fill = "#FF6666") +
      ggtitle(paste("Distribution of", feature))
  )
}
```

**The above plots give us the distributions of the measurements of fixed acidity and the amount of chlorides in the 500 samples of wine. While both plots are left-skewed, the first plot, displaying the distribution of fixed acidity, has a wider range of measurements in the 500 samples. The second plot, however, is much narrower, suggesting that the majority of the samples have a similar amount of chlorides.**

<br><br>

```{r, echo=FALSE}
# Calculate the correlation matrix
cor_matrix <- cor(select_if(wine_data_sampled, is.numeric))

# Melt the correlation matrix for ggplot2
melted_cor_matrix <- melt(cor_matrix)

# Remove duplicates (keep upper triangle, excluding diagonal)
melted_cor_matrix <- melted_cor_matrix[upper.tri(cor_matrix, diag = TRUE), ]

# Filter significant correlations to reduce clutter (optional)
melted_cor_matrix <- subset(melted_cor_matrix, value > 0.3 | value < -0.3)

# Create the heatmap
ggplot(data = melted_cor_matrix, aes(x = Var1, y = Var2)) +
  geom_tile(aes(fill = value), color = "white") +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1), name = "Correlation") +
  geom_text(aes(label = sprintf("%.2f", value)), vjust = 1, size = 4) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 11),
    axis.text.y = element_text(size = 11)
  ) +
  ggtitle("Correlation Heatmap") +
  xlab("Variables") +
  ylab("Variables") +
  coord_fixed()
```

**The Correlation Heat map summarizes the relationship each variable in our data set has with each other. We decided to only show correlations +- 0.3 level to rule out any non-statistically significant correlations. A red color signifies a positive correlation, while a purple color signifies a negative correlation.**

-   **Fixed.acidity and density have a high positive correlation**

-   **Fixed.acidity and citric acid have a high positive correlation**

-   **volatile acidity and citric acid have a high negative correlation**

-   **volatile acidity and quality have a high negative correlation**

-   **citric acid and density have a high positive correlation**

-   **residual sugars and density have a high positive correlation**

-   **density and alcohol have a high negative correlation**

-   **alcohol and quality have a high positive correlation**

<br><br>


```{r, echo=FALSE, message=FALSE}
# Plotting the relationship between alcohol content and quality
ggplot(wine_data_sampled, aes(x = alcohol, y = quality)) +
  geom_point(aes(color = quality), alpha = 0.1) +
  geom_smooth(method = "lm", se = FALSE, color = "green") +
  ggtitle("Relationship between Alcohol Content and Wine Quality") +
  xlab("Alcohol Content") +
  ylab("Wine Quality") +
  theme_minimal()

```

**From the plot above we can see the relationship between Alcohol Content and quality. The plot shows that most of the wines lie between scores 5-7, and alcohol content ranges from 9-13. This is evident by the percentiles we found earlier as well. The highest rated wines, with a rating of 8 are skewed right with most lying between the 11-14 alcohol content range. The lowest rated wines lie between the 9-11 range. This is pretty interesting because it aligns with the assumption that bad quality wines may be mass produced and therefore they may not be getting an adequate amount of time to ferment to help them develop a higher alcohol content.**
<br><br>

```{r, echo=FALSE, message=FALSE}
# Plotting the relationship between residual sugar and density
ggplot(wine_data, aes(x = residual.sugar, y = density)) +
  geom_point(aes(color = density), alpha = 0.1) +
  geom_smooth(method = "lm", se = FALSE, color = "green") +
  ggtitle("Relationship between Residual Sugar and Density") +
  xlab("Residual Sugar") + ylab("Density") +  scale_x_log10()   # Applying log scale to x-axis
```

**Above we can see the relationship between Sugar content in the wine and the density of the wine. The scatter plot shows that wines with higher residual sugar content are more likely to have a higher density. This is not a surprising outcome. Typically, the higher amount of dissolved solid in a solution, the higher the density.**

<br><br>

```{r, echo=FALSE, message=FALSE}
ggplot(wine_data_sampled, aes(x = categorical_pH, y = quality)) +
  geom_boxplot(aes(fill = categorical_pH)) +
  geom_jitter(position=position_jitter(width=0.1), alpha=0.1) +
  ggtitle("Distribution of Wine Quality Across pH Categories") +
  xlab("pH Category") +
  ylab("Wine Quality") 

```

**The box plot presents the distribution of wine quality scores across various pH categories: 'Very Low', 'Low', 'Medium', and 'High'. Each box represents the interquartile range (IQR), encapsulating the middle 50% of the quality scores within each pH category. We can see there is minimal correlation between the pH of a wine and its quality. This is interesting because pH has a huge impact on the taste and smell of wine, but this plot shows that it may not be the determining factor in the end quality rating of the wine.**
